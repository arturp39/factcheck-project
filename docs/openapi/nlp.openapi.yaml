openapi: 3.0.3
info:
  title: FactCheck NLP Service API
  version: "1.0.0"
  description: Preprocessing and embeddings microservice.
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: https://nlp.factcheck.local
    description: Default server
security: []
tags:
  - name: health
    description: Health and metrics
  - name: embeddings
    description: Preprocess and embedding generation
paths:
  /health:
    get:
      tags: [health]
      summary: Health probe
      operationId: nlpHealth
      responses:
        "200":
          description: Service status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                ok:
                  value:
                    status: healthy
                    service: nlp-service
                    version: "1.0.0"
                    vertexAI:
                      status: connected
                      model: text-embedding-004
                    uptime: 12345
        "400":
          $ref: '#/components/responses/BadRequest'
  /metrics:
    get:
      tags: [health]
      summary: Prometheus metrics
      operationId: nlpMetrics
      responses:
        "200":
          description: Prometheus text
          content:
            text/plain:
              schema:
                type: string
        "400":
          $ref: '#/components/responses/BadRequest'
  /preprocess:
    post:
      tags: [embeddings]
      summary: Split text into sentences
      operationId: nlpPreprocess
      parameters:
        - $ref: '#/components/parameters/CorrelationIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PreprocessRequest'
            examples:
              basic:
                value:
                  text: "Hello world. This is a test."
      responses:
        "200":
          description: Sentence split
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PreprocessResponse'
              examples:
                ok:
                  value:
                    sentences:
                      - "Hello world."
                      - "This is a test."
                    sentenceCount: 2
                    processingTimeMs: 12
                    correlationId: demo-123
        "400":
          $ref: '#/components/responses/BadRequest'
  /embed:
    post:
      tags: [embeddings]
      summary: Generate embeddings
      operationId: nlpEmbed
      parameters:
        - $ref: '#/components/parameters/CorrelationIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmbedRequest'
            examples:
              basic:
                value:
                  texts:
                    - "The Eiffel Tower is 330m tall."
                    - "Paris is the capital of France."
      responses:
        "200":
          description: Embeddings vector output
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmbedResponse'
              examples:
                ok:
                  value:
                    embeddings:
                      - [0.1, 0.2, 0.3]
                      - [0.0, 0.5, 0.9]
                    dimension: 3
                    model: text-embedding-004
                    processingTimeMs: 34
                    correlationId: demo-456
        "400":
          $ref: '#/components/responses/BadRequest'
        "503":
          description: Embedding provider unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                provider-down:
                  value:
                    timestamp: "2025-12-19T10:00:00Z"
                    status: 503
                    error: "Service Unavailable"
                    message: "Embedding generation failed"
                    path: "/embed"
                    correlationId: demo-789
components:
  parameters:
    CorrelationIdHeader:
      in: header
      name: X-Correlation-Id
      schema:
        type: string
      required: false
      description: Optional correlation ID; autogenerated if omitted.
  responses:
    BadRequest:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2025-12-19T08:00:00Z"
            status: 400
            error: "Bad Request"
            message: "text cannot be empty or whitespace only"
            path: "/preprocess"
            correlationId: "abc"
  schemas:
    ErrorResponse:
      type: object
      properties:
        timestamp: { type: string, format: date-time }
        status: { type: integer }
        error: { type: string }
        message: { type: string }
        path: { type: string }
        correlationId: { type: string }
    PreprocessRequest:
      type: object
      required: [text]
      properties:
        text:
          type: string
          minLength: 1
        correlationId:
          type: string
          nullable: true
    PreprocessResponse:
      type: object
      properties:
        sentences:
          type: array
          items:
            type: string
        sentenceCount:
          type: integer
        processingTimeMs:
          type: integer
        correlationId:
          type: string
          nullable: true
    EmbedRequest:
      type: object
      required: [texts]
      properties:
        texts:
          type: array
          minItems: 1
          items:
            type: string
        correlationId:
          type: string
          nullable: true
    EmbedResponse:
      type: object
      properties:
        embeddings:
          type: array
          items:
            type: array
            items:
              type: number
              format: float
        dimension:
          type: integer
        model:
          type: string
        processingTimeMs:
          type: integer
        correlationId:
          type: string
          nullable: true
    HealthResponse:
      type: object
      properties:
        status: { type: string }
        service: { type: string }
        version: { type: string }
        vertexAI:
          type: object
          properties:
            status: { type: string }
            model: { type: string }
        uptime: { type: integer }
