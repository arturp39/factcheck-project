<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>FactCheck Assistant</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
</head>
<body class="page">

<header class="header">
    <div class="header-title">FactCheck Assistant</div>
    <div class="header-subtitle">
        Enter a factual claim and the assistant will search recent news,
        retrieve evidence and ask an LLM to evaluate it.
    </div>
    <div class="header-actions">
        <a href="/auth/logout" class="link-logout">Sign out</a>
    </div>
</header>

<main class="main">

    <!-- Error message (validation, backend errors, etc.) -->
    <div th:if="${error}" class="alert alert-error" th:text="${error}">
        Error message
    </div>

    <!-- Loading indicator (simple, controlled by JS) -->
    <div id="loading" class="loading" style="display: none;">
        Checking your claim, please wait...
    </div>

    <section class="card">
        <h2 class="section-title">New fact-check</h2>

        <form action="#" th:action="@{/verify}" method="post" class="claim-form" novalidate>
            <label for="claim" class="form-label">Enter factual claim:</label>
            <textarea id="claim"
                      name="claim"
                      class="form-textarea"
                      placeholder="Example: The European Central Bank cut its main interest rate at its most recent meeting."
                      th:attr="maxlength=${@environment.getProperty('app.claim.max-length','400')},data-maxlength=${@environment.getProperty('app.claim.max-length','400')}"
                      required></textarea>
            <div id="claim-error" class="alert alert-error" style="display: none;">
                Claim is required.
            </div>

            <div class="form-footer">
                <button type="submit" class="btn btn-primary">Verify</button>
            </div>
        </form>
    </section>

    <section class="card card-hint">
        <h3 class="section-subtitle">Tips for good claims</h3>
        <ul class="hint-list">
            <li>Use concrete, factual statements.</li>
            <li>Avoid very broad or vague opinions (e.g. "This politician is bad").</li>
            <li>Keep the claim under 2-3 sentences for best results.</li>
        </ul>
    </section>

    <section class="card" th:if="${!#lists.isEmpty(recentClaims)}">
        <h3 class="section-subtitle">Recent conversations</h3>
        <ul class="history-list">
            <li th:each="c : ${recentClaims}" class="history-item">
                <a th:href="@{'/history/' + ${c.id}}" class="history-link">
                    <span class="history-claim" th:text="${c.claimText}">Claim text</span>
                    <span class="history-meta" th:text="${c.verdict} ?: 'unclear'">unclear</span>
                </a>
            </li>
        </ul>
    </section>

</main>

<script>
    (function () {
        const form = document.querySelector('.claim-form');
        const loading = document.getElementById('loading');
        const claim = document.getElementById('claim');
        const errorBox = document.getElementById('claim-error');

        if (form && loading && claim && errorBox) {
            const maxLen = parseInt(claim.dataset.maxlength || '', 10);

            form.addEventListener('submit', function (event) {
                const trimmed = claim.value.trim();
                let error = '';
                if (!trimmed) {
                    error = 'Claim must not be empty.';
                } else if (!Number.isNaN(maxLen) && trimmed.length > maxLen) {
                    error = 'Claim is too long. Please keep it under ' + maxLen + ' characters.';
                }

                if (error) {
                    event.preventDefault();
                    errorBox.textContent = error;
                    errorBox.style.display = 'block';
                    loading.style.display = 'none';
                    return;
                }

                errorBox.style.display = 'none';
                loading.style.display = 'block';
            });
        }
    })();
</script>

</body>
</html>
